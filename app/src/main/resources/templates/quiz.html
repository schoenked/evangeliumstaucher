<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:th="http://www.thymeleaf.org">
<head>
    <head th:insert="head.html :: head"/>
    <title>Quiz Page</title>
</head>
<body>
<!-- Importing NavBar -->
<div th:insert="navbar.html :: navbar"></div>
<!--/*@thymesVar id="question" type="de.evangeliumstaucher.app.viewmodel.RunningQuestion"*/-->
<div class="container py-5 px-4">

    <script>
        function loadPassageAjax(path) {
            $.ajax({
                url: path,
                success: function (data) {
                    $('#waiting' + path).replaceWith(data);
                }
            });
        }
    </script>
    <div id="quizpassage">
        <div th:insert="passageContextLoading.html :: passageContextLoading(${question.pre})"></div>
        <div th:insert="passageContextLoading.html :: passageContextLoading(${question.origin})"></div>
        <div th:insert="passageContextLoading.html :: passageContextLoading(${question.post})"></div>
    </div>
    <div th:insert="fragment-selector.html :: selector (${question.books})"></div>
</div>

<!--handling the zoom -> text scaling-->
<script>
    const box = document.getElementById("quizpassage");

    function scale(summand) {
        const currentFontSize = parseFloat(getComputedStyle(box).fontSize);
        const newFontSize = currentFontSize + summand;
        box.style.fontSize = newFontSize + "px";
    }

    function handleWheel(event) {
        if (event.ctrlKey) {
            event.preventDefault();
            const delta = -event.deltaY;
            scale(delta / 20);
        }
    }

    box.addEventListener("wheel", handleWheel, {passive: false});

    let hypo = undefined;

    box.addEventListener('touchmove', function (event) {
        var summand;
        if (event.targetTouches.length === 2) {
            event.preventDefault();
            let hypo1 = Math.hypot((event.targetTouches[0].pageX - event.targetTouches[1].pageX),
                (event.targetTouches[0].pageY - event.targetTouches[1].pageY));
            if (hypo === undefined) {
                hypo = hypo1;
            }
            summand = ((hypo1 / hypo) - 1) * 5;
            console.log("pinch scale summand :" + summand);
            scale(hypo1 / hypo);
        }
    }, false);

    box.addEventListener('touchend', function (event) {
        hypo = undefined;
    }, false);

    /*
    function handlePan(event) {
        scale((event.scale - 1) * 50);
    }

    function handlePinch(event) {
        scale((event.scale - 1) * 5);
    }*/
    /*
        const hammer = new Hammer(box);
        hammer.get('pinch').set({enable: true});

        hammer.on("pinch", handlePinch);
        hammer.get('pan').set({
            enable: true,
            touchAction: 'none'
        });*/
</script>

<!-- Importing Footer -->
<div th:insert="footer.html :: footer"></div>
</body>
</html>